) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(10000) %>%
st_transform(st_crs(ssurgo))
View(pts)
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(10000) %>%
st_transform(st_crs(ssurgo))
View(pts)
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(10000) #%>%
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) #%>%
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) #%>%
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(10000) #%>%
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) #%>%
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) #%>%
View(pts)
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) #%>%
View(blm_admnu)
pts <- tibble(
pt = c('a','b','c','d'),
lat = c(38.550773, 38.228984, 38.367782, 38.512936),
long = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) #%>%
ggplot(pts) +
geom_sf()
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) #%>%
ggplot(pts) +
geom_sf()
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(10000) #%>%
ggplot(pts) +
geom_sf()
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(5000) #%>%
head(ssurgo)
str(ssurgo)
spatial <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern  = 'soilmu_a.*.shp$', recursive = T))
component <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'comp', recursive = T))
ecoclass <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'cecoclas.txt', recursive = T))
spatial <- do.call(bind_rows,
lapply(spatial, st_read, quiet = T))
component <- do.call(rbind,
lapply(component, read_delim, delim = "|", col_names = F, show_col_types = FALSE))[,108:109]
names(component) <- c('mukey','cokey')
ecoclass <- do.call(rbind,
lapply(ecoclass, read_delim, delim = "|", col_names = F, show_col_types = FALSE))
names(ecoclass) <-  c('ecoclasstypename', 'ecoclassref', 'ecoclassid', 'ecoclassname', 'cokey', 'coecoclasskey')
ecoclass <- left_join(ecoclass, component, by = 'cokey') %>%
mutate(mukey = as.character(mukey))
ssurgo <- left_join(spatial, ecoclass, by = c('MUKEY' = 'mukey'))
blm_admnu <- st_transform(blm_admnu, st_crs(ssurgo))
ssurgo_valid <- st_is_valid(ssurgo)
invalid <- as.numeric(which(ssurgo_valid %in% F))
ssurgo[invalid,] <- st_make_valid(ssurgo[invalid,])
ssurgo_lookup <- st_intersects(blm_admnu, ssurgo, sparse = T)
ssurgo <- ssurgo[ssurgo_lookup[[1]],] %>%
select(7:11)
ggplot(blm_admnu) +
geom_sf(fill = 'yellow') +
geom_sf(data = ssurgo)
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = '
rm(ecoclass, component, ssurgo_valid, ssurgo_lookup, invalid, spatial)
View(ssurgo)
pts <- tibble(
pt = c('a','b','c','d'),
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(5000) %>%
st_transform(st_crs(ssurgo))
rm(ecoclass, component, ssurgo_valid, ssurgo_lookup, invalid, spatial)
this <- st_intersection(ssurgo, pts)
this %>%
st_drop_geometry()
this %>%
st_drop_geometry() %>%
distinct('ecoclassid', .keep_all = T)
this %>%
st_drop_geometry() %>%
group_by(pt) %>%
distinct('ecoclassid', .keep_all = T)
this %>%
st_drop_geometry() %>%
group_by(pt) %>%
distinct(ecoclassid, .keep_all = T)
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(3000) %>%
st_transform(st_crs(ssurgo))
this <- st_intersection(ssurgo, pts)
this <- st_intersection(ssurgo, pts)
this %>%
st_drop_geometry() %>%
group_by(pt) %>%
distinct(ecoclassid, .keep_all = T)
View(this)
this %>%
group_by(pt, ecoclassid) %>%
summarize(geometry = st_union(geometry))
this %>%
group_by(pt, ecoclassid) %>%
summarize(geometry = st_union(geometry)) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid) %>%
mutate(geometry = st_union(geometry)) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid) %>%
mutate(geometry = st_union(geometry)) %>%
mutate('Area' = st_area(.)) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid) %>%
mutate(geometry = st_union(geometry)) %>%
mutate('Area' = st_area(x)) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid) %>%
mutate(geometry = st_union(geometry)) %>%
mutate('Area' = st_area()) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid) %>%
mutate(geometry = st_union(geometry)) #%>%
this %>%
group_by(pt, ecoclassid) %>%
summarize(geometry = st_union(geometry)) #%>%
this %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry)) #%>%
this %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry)) %>%
mutate('Area' = st_area()) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry)) %>%
mutate('Area' = st_area(.)) %>%
distinct(ecoclassid, .keep_all = T)
this %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry)) %>%
mutate('Area' = st_area(this)) %>%
distinct(ecoclassid, .keep_all = T)
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry))
st_area(this)
pts[,1]
st_area(pts[,1])
28220986/
mutate('Area' = st_area(this)) %>%
distinct(ecoclassid, .keep_all = T)
28220986/28204281
28204281/28189128
pi(3000^2)
pi
pi*(3000^2)
pi*(3000^2)/28189128
st_area(this)/pi*(3000^2)
st_area(this)/1000
(st_area(this)/1000)/pi*(3000^2)
pi*(3^2)
(st_area(this)/1000)/pi*(3^2)
pi*(3^2)
st_area(this)
(st_area(this)/1000)
ggplot(this) +
geom_sf()
(st_area(this)/1000)
st_area(this)/1000
pi*(3^2)
pi*(3000^2)
pi*(3000^2)/1000
0
st_area(this)/1000
st_area(this)/1000/pi*(3000^2)/1000
st_area(this)/1000
pi*(3000^2)
st_area(this)/1000
pi*(3000^2)/1000
st_area(this)/1000
4306.05152/
pi*(3000^2)/1000
4306.05152/12335929
4306.05152/12335929 * 100
(4306.05152/12335929) * 100
pi*(3000^2)/1000
st_area(this)/1000
(st_area(this)/1000) / (pi*(3000^2)/1000)
(st_area(this)/1000) / (pi*(3000^2)/1000) * 100
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry)) %>%
mutate(AREA = (st_area()/1000) / (pi*(3000^2)/1000) * 100)
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry)) %>%
mutate(AREA = (st_area(.)/1000) / (pi*(3000^2)/1000) * 100) %>%
distinct(ecoclassid, .keep_all = T)
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry))
this <- this %>%
mutate(AREA = ((st_area(.)/1000) / (pi*(3000^2)/1000)) * 100) %>%
distinct(ecoclassid, .keep_all = T)
this <- this %>%
mutate(AREA = ((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100) %>%
distinct(ecoclassid, .keep_all = T)
this$AREA <- ((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100) %>%
this$AREA <- ((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100)
this$AREA <- ((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100
View(this)
head(this)
print(this)
this$Area <- ((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100
this$Area <- as.numeric(((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100)
print(this)
this$Area <- round(as.numeric(((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100), 0)
print(this)
this$PrcntArea <- round(as.numeric(((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100), 0)
library(tidyverse)
library(here)
library(janitor)
library(sf)
blm_admnu <- st_read(paste0(here(), '/data/raw/blm_co_admu_fo_shp/',
list.files(paste0(here(), '/data/raw/blm_co_admu_fo_shp'), pattern = '.shp$')),
quiet = T)
spatial <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern  = 'soilmu_a.*.shp$', recursive = T))
component <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'comp', recursive = T))
ecoclass <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'cecoclas.txt', recursive = T))
spatial <- do.call(bind_rows,
lapply(spatial, st_read, quiet = T))
component <- do.call(rbind,
lapply(component, read_delim, delim = "|", col_names = F, show_col_types = FALSE))[,108:109]
names(component) <- c('mukey','cokey')
ecoclass <- do.call(rbind,
lapply(ecoclass, read_delim, delim = "|", col_names = F, show_col_types = FALSE))
names(ecoclass) <-  c('ecoclasstypename', 'ecoclassref', 'ecoclassid', 'ecoclassname', 'cokey', 'coecoclasskey')
ecoclass <- left_join(ecoclass, component, by = 'cokey') %>%
mutate(mukey = as.character(mukey))
ssurgo <- left_join(spatial, ecoclass, by = c('MUKEY' = 'mukey'))
blm_admnu <- st_transform(blm_admnu, st_crs(ssurgo))
ssurgo_valid <- st_is_valid(ssurgo)
invalid <- as.numeric(which(ssurgo_valid %in% F))
ssurgo[invalid,] <- st_make_valid(ssurgo[invalid,])
ssurgo_lookup <- st_intersects(blm_admnu, ssurgo, sparse = T)
ssurgo <- ssurgo[ssurgo_lookup[[1]],] %>%
select(7:11)
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(3000) %>%
st_transform(st_crs(ssurgo))
ggplot(pts) +
geom_sf()
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry))
this$PrcntArea <- round(
as.numeric(
((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100
),
0)
print(this)
this$PrcntArea <- round(
as.numeric(
((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100
),
1)
print(this)
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry))
View(this)
blm_admnu <- st_read(paste0(here(), '/data/raw/blm_co_admu_fo_shp/',
list.files(paste0(here(), '/data/raw/blm_co_admu_fo_shp'), pattern = '.shp$')),
quiet = T)
blm_admnu <- blm_admnu  %>%
filter(ADMU_NAME == 'UNCOMPAHGRE FIELD OFFICE') %>%
st_transform(32613) %>%  # we transfor to a PLANAR projection in meters so we can buffer it
st_buffer(10000)# %>%  # buffer the FO by 10 km
spatial <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern  = 'soilmu_a.*.shp$', recursive = T))
component <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'comp', recursive = T))
ecoclass <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'cecoclas.txt', recursive = T))
spatial <- do.call(bind_rows,
lapply(spatial, st_read, quiet = T))
component <- do.call(rbind,
lapply(component, read_delim, delim = "|", col_names = F, show_col_types = FALSE))[,108:109]
names(component) <- c('mukey','cokey')
ecoclass <- do.call(rbind,
lapply(ecoclass, read_delim, delim = "|", col_names = F, show_col_types = FALSE))
names(ecoclass) <-  c('ecoclasstypename', 'ecoclassref', 'ecoclassid', 'ecoclassname', 'cokey', 'coecoclasskey')
ecoclass <- left_join(ecoclass, component, by = 'cokey') %>%
mutate(mukey = as.character(mukey))
ssurgo <- left_join(spatial, ecoclass, by = c('MUKEY' = 'mukey'))
blm_admnu <- st_transform(blm_admnu, st_crs(ssurgo))
ssurgo_valid <- st_is_valid(ssurgo)
invalid <- as.numeric(which(ssurgo_valid %in% F))
ssurgo[invalid,] <- st_make_valid(ssurgo[invalid,])
ssurgo_lookup <- st_intersects(blm_admnu, ssurgo, sparse = T)
ssurgo <- ssurgo[ssurgo_lookup[[1]],] %>%
select(7:11)
pts <- tibble(
pt = c('a','b','c','d'),
long = c(38.550773, 38.228984, 38.367782, 38.512936),
lat = c(-107.837138, -108.391745, -108.882819, -108.757585)
) %>%
st_as_sf(coords = c(x = 'lat', y = 'long'), crs = 4326) %>%
st_transform(32613) %>%
st_buffer(3000) %>%
st_transform(st_crs(ssurgo))
this <- st_intersection(ssurgo, pts) %>%
group_by(pt, ecoclassid, ecoclassname) %>%
summarize(geometry = st_union(geometry))
this$PrcntArea <- round(
as.numeric(
((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100
),
1)
print(this)
ggplot(this) +
geom_sf()
View(this)
ggplot(this, aes(color = ecoclassid)) +
geom_sf()
ggplot(this, aes(fill = ecoclassid)) +
geom_sf()
this$PrcntArea <- round(
as.numeric(
((st_area(this)/1000) / (pi*(3^2))) * 100
),
1)
this$PrcntArea <- round(
as.numeric(
((st_area(this)/1000) / (pi*(3^2)/1000)) * 100
),
1)
this$PrcntArea <- round(
as.numeric(
((st_area(this)/1000) / (pi*(3000^2)/1000)) * 100
),
1)
ggplot(this, aes(fill = ecoclassid)) +
geom_sf()
ggplot(this, aes(fill = ecoclassid)) +
geom_sf() +
facet_wrap(~pts)
ggplot(this, aes(fill = ecoclassid)) +
geom_sf() +
facet_wrap(~pt)
ggplot(this, aes(fill = ecoclassid)) +
geom_sf() +
facet_wrap(~pt, scales = 'free')
?facet_wrap
ggplot(this, aes(fill = ecoclassid)) +
geom_sf() +
facet_wrap(~pt, scales = "free")
ggplot(this, aes(fill = ecoclassid)) +
geom_sf()
rm(ecoclass, component, ssurgo_valid, ssurgo_lookup, invalid, spatial)
st_write(ssurgo, paste0(here(), '/data/processed/ssurgo.shp')
blm_admnu <- st_read(paste0(here(), '/data/raw/blm_co_admu_fo_shp/',
library(tidyverse)
library(here)
library(janitor)
library(sf)
blm_admnu <- st_read(paste0(here(), '/data/raw/blm_co_admu_fo_shp/',
list.files(paste0(here(), '/data/raw/blm_co_admu_fo_shp'), pattern = '.shp$')),
quiet = T)
blm_admnu <- blm_admnu  %>%
filter(ADMU_NAME == 'UNCOMPAHGRE FIELD OFFICE') %>%
st_transform(32613) %>%  # we transfor to a PLANAR projection in meters so we can buffer it
st_buffer(10000) #%>%  # buffer the FO by 10 km
spatial <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern  = 'soilmu_a.*.shp$', recursive = T))
component <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'comp', recursive = T))
ecoclass <- paste0(here(), '/data/raw/ssurgo/',
list.files(paste0(here(), '/data/raw/ssurgo/'),
pattern = 'cecoclas.txt', recursive = T))
spatial <- do.call(bind_rows,
lapply(spatial, st_read, quiet = T))
component <- do.call(rbind,
lapply(component, read_delim, delim = "|", col_names = F, show_col_types = FALSE))[,108:109]
names(component) <- c('mukey','cokey')
ecoclass <- do.call(rbind,
lapply(ecoclass, read_delim, delim = "|", col_names = F, show_col_types = FALSE))
names(ecoclass) <-  c('ecoclasstypename', 'ecoclassref', 'ecoclassid', 'ecoclassname', 'cokey', 'coecoclasskey')
ecoclass <- left_join(ecoclass, component, by = 'cokey') %>%
mutate(mukey = as.character(mukey))
ssurgo <- left_join(spatial, ecoclass, by = c('MUKEY' = 'mukey'))
blm_admnu <- st_transform(blm_admnu, st_crs(ssurgo))
ssurgo_valid <- st_is_valid(ssurgo)
invalid <- as.numeric(which(ssurgo_valid %in% F))
ssurgo[invalid,] <- st_make_valid(ssurgo[invalid,])
ssurgo_lookup <- st_intersects(blm_admnu, ssurgo, sparse = T)
ssurgo <- ssurgo[ssurgo_lookup[[1]],] %>%
select(7:11)
st_write(ssurgo, paste0(here(), '/data/processed/ssurgo.shp')
st_write(ssurgo, paste0(here(), '/data/processed/ssurgo.shp'), quiet = T)
head(ssurgo)
paste0(here(), '/data/processed/ssurgo.shp')
st_write(ssurgo, paste0(here(), '/data/processed/ssurgo.shp'), quiet = T)
rm(ecoclass, component, ssurgo_valid, ssurgo_lookup, invalid, spatial)
gc()
